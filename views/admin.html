<!doctype html>
<html lang="ar" dir="rtl">  
<head>  
<meta charset="utf-8">  
<meta name="viewport" content="width=device-width,initial-scale=1">  
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (ğŸ”’)</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">  
<style>  
/* (Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø£Ù†Ù…Ø§Ø· CSS Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§ Ø³Ø§Ø¨Ù‚Ø§Ù‹ ÙÙŠ admin.html) */
:root{  
  --bg: #0b0b0c;  
  --text-primary: #ffffff;  
  --text-secondary: #a1a1aa;  
  --border-color: rgba(255,255,255,0.08);  
  --accent-color: #3b82f6;   
  --nav-height: 72px;  
  --radius: 12px;  
}  
/* ... (ÙƒÙˆØ¯ CSS Ù†ÙØ³Ù‡ Ù…Ù† admin.html Ø§Ù„Ø³Ø§Ø¨Ù‚) ... */
*{box-sizing:border-box;}  
html,body{  
  height:100%;  
  margin:0;  
  font-family: "Tajawal", sans-serif;  
  background-color: var(--bg);  
  background-image:   
    radial-gradient(circle at 15% 50%, rgba(255, 255, 255, 0.03) 0%, transparent 25%),  
    radial-gradient(circle at 85% 30%, rgba(255, 255, 255, 0.02) 0%, transparent 25%);  
  color: var(--text-primary);  
  -webkit-font-smoothing:antialiased;  
  direction: rtl;  
}  
.page{  
  min-height:100vh;  
  display:flex;  
  flex-direction:column;
}  
.navbar{  
  height: var(--nav-height);  
  display: flex;  
  align-items: center;  
  justify-content: space-between;  
  padding: 0 20px;  
  margin: 16px;  
  border-radius: var(--radius);  
  background: rgba(26, 26, 29, 0.85);   
  backdrop-filter: blur(12px);  
  border: 1px solid var(--border-color);  
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);  
  position: relative;  
  z-index: 1000;  
}  
.brand{  
  display:flex;  
  align-items:center;  
  gap:14px;  
  flex-shrink: 0;   
}  
.brand img{  
  width:48px;  
  height:48px;  
  border-radius: 10px;  
  object-fit: cover;  
  border: 1px solid rgba(255,255,255,0.1);  
}  
.brand .title .name{  
  font-weight: 800;  
  font-size: 18px;  
  color: #fff;  
  line-height: 1.2;  
}  
.brand .title .tag{  
  font-size: 13px;  
  color: var(--text-secondary);  
  font-weight: 400;  
  margin-top: 2px;  
}  
.dashboard{
    padding: 20px;
    flex: 1;
}
.dashboard h1{
    font-size: 24px;
    border-bottom: 2px solid var(--accent-color);
    display: inline-block;
    padding-bottom: 5px;
    margin-bottom: 30px;
}
.card{
    background: rgba(26, 26, 29, 0.6);
    backdrop-filter: blur(8px);
    border-radius: var(--radius);
    padding: 20px;
    border: 1px solid var(--border-color);
    margin-bottom: 20px;
}
.card h2{
    font-size: 18px;
    margin-top: 0;
    color: var(--accent-color);
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 10px;
    margin-bottom: 20px;
}
.requests-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}
.requests-table th, .requests-table td {
    padding: 12px 15px;
    text-align: right;
    border-bottom: 1px solid var(--border-color);
}
.requests-table th {
    background-color: rgba(255,255,255,0.05);
    color: #fff;
    font-weight: 600;
}
.requests-table tr:hover {
    background-color: rgba(255,255,255,0.03);
}
.requests-table tbody tr:last-child td {
    border-bottom: none;
}
.action-btn {
    padding: 8px 15px;
    margin: 5px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.2s;
    font-family: inherit;
    font-size: 13px;
}
.accept-btn {
    background-color: #10b981; 
    color: white;
}
.reject-btn {
    background-color: #ef4444; 
    color: white;
}
.accept-btn:hover { background-color: #059669; }
.reject-btn:hover { background-color: #dc2626; }
#loadingMessage {
    color: var(--text-secondary);
    text-align: center;
    padding: 30px;
}
#noRequests {
    color: #fcd34d; 
    text-align: center;
    padding: 30px;
}
footer{  
  text-align:center;  
  padding:20px;  
  color:var(--text-secondary);  
  font-size:13px;  
  border-top: 1px solid var(--border-color);
  margin-top: auto;
} 
</style>  
</head>  
<body>  
<div class="page">  
  <header class="navbar">  
    <div class="brand">  
      <img src="https://res.cloudinary.com/duixjs8az/image/upload/v1765132270/post_media/1765132269901-1765132158292.jpg" alt="Logo">  
      <div class="title">  
        <div class="name">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</div>  
        <div class="tag">Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (ÙˆØµÙˆÙ„ Ø³Ø±ÙŠ)</div>  
      </div>  
    </div>  
    <a href="/" style="color: var(--accent-color); text-decoration: none; font-weight: 600;">
        â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    </a>
  </header>  

  <main class="dashboard">
    <h1>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h1>

    <div class="card">
        <h2>ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h2>
        <p id="loadingMessage">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
        <p id="noRequests" style="display: none;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹Ù„Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ù„Ù†Ø¸Ø§Ù… Ù†Ø¸ÙŠÙ!</p>
        
        <div style="overflow-x: auto;">
            <table class="requests-table" id="pendingRequestsTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                        <th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                        <th>Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</th>
                        <th>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>

  </main>

  <footer>  
    <span id="year"></span> Â© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ù…Ø¹Ø§Ù„ÙŠ - Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
  </footer>  
</div>  

<script>
    document.getElementById('year').innerText = new Date().getFullYear();

    // ğŸ”´ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ Ù…Ù† URL Ø§Ù„ØµÙØ­Ø©
    const pathParts = window.location.pathname.split('/');
    const secretKey = pathParts[pathParts.length - 1]; 
    
    if (secretKey.length < 5) {
        // Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
        document.body.innerHTML = '<h1 style="color: #ef4444; text-align: center; margin-top: 50px;">ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„.</h1>';
        throw new Error("Secret Key Missing or Invalid");
    }

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø°ÙŠ Ø³ÙŠÙØ±Ø³Ù„ Ù…Ø¹ ÙƒÙ„ Ø·Ù„Ø¨
    const headers = { 
        'Content-Type': 'application/json',
        'x-admin-secret': secretKey 
    };

    async function fetchPendingRequests() {
        const loadingMessage = document.getElementById('loadingMessage');
        const noRequests = document.getElementById('noRequests');
        const table = document.getElementById('pendingRequestsTable');
        const tbody = table.querySelector('tbody');

        loadingMessage.style.display = 'block';
        table.style.display = 'none';
        tbody.innerHTML = '';

        try {
            const response = await fetch('/api/admin/pending', { headers });
            const requests = await response.json();

            loadingMessage.style.display = 'none';

            if (!response.ok) {
                if (response.status === 403) {
                    loadingMessage.innerText = 'ğŸ”’ ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚: Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­.';
                } else {
                    loadingMessage.innerText = `âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: ${requests.message || response.statusText}`;
                }
                return;
            }

            if (requests.length === 0) {
                noRequests.style.display = 'block';
                return;
            }

            requests.forEach(req => {
                const tr = document.createElement('tr');
                const date = new Date(req.createdAt).toLocaleDateString('ar-EG', { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                
                tr.innerHTML = `
                    <td>${req.name}</td>
                    <td>${req.level} - ${req.year}</td>
                    <td>${req.subject}</td>
                    <td>${req.contact || '---'}</td>
                    <td>${date}</td>
                    <td>
                        <button class="action-btn accept-btn" onclick="handleAction('${req.id}', 'accept')">Ù‚Ø¨ÙˆÙ„</button>
                        <button class="action-btn reject-btn" onclick="handleAction('${req.id}', 'reject')">Ø±ÙØ¶</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            noRequests.style.display = 'none';
            table.style.display = 'table';

        } catch (error) {
            loadingMessage.innerText = 'âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù….';
            console.error('Fetching error:', error);
        }
    }

    async function handleAction(id, action) {
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${action === 'accept' ? 'Ù‚Ø¨ÙˆÙ„' : 'Ø±ÙØ¶'} Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø·Ø§Ù„Ø¨ØŸ`)) {
            return;
        }

        const endpoint = `/api/admin/${action}/${id}`;
        
        try {
            const response = await fetch(endpoint, {
                method: 'POST',
                headers: headers // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ
            });

            const data = await response.json();

            if (response.ok) {
                alert(`âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­: ${data.message}`);
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
                fetchPendingRequests();
            } else {
                alert(`âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡: ${data.message}`);
            }

        } catch (error) {
            console.error('Action error:', error);
            alert('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….');
        }
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', fetchPendingRequests);

</script>  
</body>  
</html>
